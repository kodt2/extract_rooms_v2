# Руководство: как писать кастомные конфиги для генерации PDF

Этот файл описывает формат JSON-конфига для режима `render-pdf`.

## 1) Быстрый старт

1. Скопируйте `pdf_template.example.json` в свой файл, например `my_template.json`.
2. Подготовьте входные данные в JSON, например `my_data.json`.
3. Запустите:

```bash
python -m app.main --mode render-pdf --template my_template.json --data my_data.json --output output/result.pdf
```

---

## 2) Верхнеуровневая структура конфига

```json
{
  "page": { "width": 595.28, "height": 841.89 },
  "default_font": { "name": "Helvetica", "size": 12 },
  "pages": [ ... ]
}
```

- `page.width`, `page.height` — размер страницы в пунктах (A4: `595.28 x 841.89`).
- `default_font.size` — размер шрифта по умолчанию.
- `pages` — список описаний страниц.

---

## 3) Как строятся страницы

Каждый элемент в `pages` — это страница-шаблон.

### 3.1 Обычная страница

```json
{
  "items": [ ... ]
}
```

Будет создана ровно 1 страница.

### 3.2 Повторяемая страница (много страниц из массива)

```json
{
  "repeat_for": "report.appendix_pages",
  "items": [ ... ]
}
```

- `repeat_for` должен указывать на массив в данных.
- Для каждого элемента массива будет создана отдельная страница.
- Внутри страницы доступны переменные:
  - `{{item}}` — текущий элемент массива.
  - `{{index}}` — индекс элемента (начиная с 0).

---

## 4) Элементы страницы (`items`)

Поддерживаются два типа:

1. `text` — одна строка текста.
2. `array_text` — печать массива строкой за строкой.

### 4.1 `text`

```json
{
  "type": "text",
  "value": "Отчёт: {{report.title}}",
  "top": 40,
  "align": "center",
  "margin_left": 40,
  "margin_right": 40,
  "font_size": 16
}
```

Поля:
- `value` — шаблон текста с переменными `{{path.to.value}}`.
- `top` **или** `bottom` — позиция по вертикали:
  - `top`: отступ сверху;
  - `bottom`: отступ снизу.
- `align`: `left | center | right`.
- `margin_left`, `margin_right` — отступы слева/справа.
- `font_size` — размер шрифта (опционально).

### 4.2 `array_text`

```json
{
  "type": "array_text",
  "source": "report.rows",
  "item_template": "{{index}}. {{item}}",
  "top": 130,
  "line_height": 20,
  "align": "left",
  "margin_left": 40,
  "margin_right": 40
}
```

Поля:
- `source` — путь к массиву в данных.
- `item_template` — шаблон одной строки массива.
- `top`/`bottom`, `align`, `margin_left`, `margin_right`, `font_size` — как у `text`.
- `line_height` — расстояние между строками массива.

Внутри `item_template` доступны:
- `{{item}}` — текущий элемент массива.
- `{{index}}` — индекс текущего элемента.

---

## 5) Шаблонизация переменных

Подстановка делается по паттерну:

```text
{{report.title}}
{{report.author}}
{{item.title}}
{{index}}
```

Поддерживаются пути через точку (`a.b.c`).

Если путь не найден или тип данных неверный (например, ожидался массив), генерация завершится с ошибкой.

---

## 6) Что важно для позиционирования

- Выравнивание (`align`) работает внутри зоны между `margin_left` и `margin_right`.
- `left` — от левого края зоны.
- `center` — по центру зоны.
- `right` — от правого края зоны.
- `bottom` — удобен для подписи/футера.

---

## 7) Практические рекомендации

- Начинайте с простого конфига на 1 страницу.
- Постепенно добавляйте `array_text` и `repeat_for`.
- Держите все «важные» параметры в конфиге (позиции, отступы, шрифты, шаблоны текста).
- Для отладки используйте `pdf_template.example.json` и `pdf_data.example.json` как базу.
